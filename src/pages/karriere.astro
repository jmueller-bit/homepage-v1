---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import Section from '../components/Section.astro';
import { getJobs } from '../lib/contentful';
import { documentToHtmlString } from '@contentful/rich-text-html-renderer';

const jobs = await getJobs();

// Hilfsfunktion zum Rendern von RichText
function renderRichText(document: unknown): string {
  if (!document) return '';
  try {
    return documentToHtmlString(document as any);
  } catch (e) {
    console.error('Error rendering rich text:', e);
    return '';
  }
}
---

<BaseLayout title="Karriere">
  <Hero
    title="Arbeiten im <span class='hero-title-accent'>Zentrum</span>"
    description="Werden Sie Teil unseres p√§dagogischen Teams und gestalten Sie die Zukunft der Reformp√§dagogik aktiv mit."
    badge="Jobs & Karriere"
    imagePlaceholder="JOBS"
  />

  <Section
    title="Offene Stellen"
    description="Wir suchen Menschen mit Leidenschaft f√ºr P√§dagogik und Begeisterung f√ºr neue Wege des Lernens."
    variant="alt"
  >
    {jobs.length === 0 ? (
      <div class="empty-jobs">
        <p class="empty-text">Aktuell sind keine offenen Stellen ausgeschrieben.</p>
        <p class="empty-subtext">Gerne k√∂nnen Sie uns eine Initiativbewerbung senden!</p>
      </div>
    ) : (
      <div class="jobs-grid">
        {jobs.map((job) => (
          <div class="job-card" data-job-id={job.id}>
            <div class="job-header">
              <h3 class="job-title">{job.title}</h3>
            </div>

            <div class="job-short-desc">
              <p>{job.descriptionShort}</p>
            </div>

            <button class="btn-details" onclick={`toggleJobDetails('${job.id}')`}>
              <span class="btn-text">Mehr erfahren</span>
              <span class="btn-icon">‚ñº</span>
            </button>

            <div class="job-details" id={`details-${job.id}`} style="display: none;">
              <div class="details-content">
                <div class="rich-text-content" set:html={renderRichText(job.descriptionLong)}></div>

                {job.media && job.media.length > 0 && (
                  <div class="job-media">
                    <h4>Zus√§tzliche Informationen</h4>
                    <div class="media-grid">
                      {job.media.map((media) => (
                        <a href={media.url} target="_blank" rel="noopener noreferrer" class="media-item">
                          <span class="media-icon">üìé</span>
                          <span class="media-title">{media.title || 'Download'}</span>
                        </a>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>

            <div class="job-actions">
              <a href="/kontakt" class="btn btn-primary">Jetzt bewerben</a>
            </div>
          </div>
        ))}
      </div>
    )}
  </Section>

  <Section title="Warum ALZ?">
    <div class="grid grid-2">
      <div class="benefits">
        <h3>Ihre Vorteile</h3>
        <ul class="benefit-list" style="margin-top: var(--space-4); list-style: none;">
          <li>‚ú® Reformp√§dagogische Freir√§ume</li>
          <li>ü§ù Kollegiales Miteinander</li>
          <li>üìö Fortbildungsm√∂glichkeiten</li>
          <li>‚öñÔ∏è Work-Life-Balance</li>
          <li>üå≥ Idyllische Lage am Campus</li>
        </ul>
      </div>
      <div class="apply-info">
        <h3>Initiativbewerbung</h3>
        <p>Gerne k√∂nnen Sie uns auch eine Initiativbewerbung senden. Wir sind immer auf der Suche nach motivierten p√§dagogischen Fachkr√§ften, die neue Wege des Lernens mit uns gestalten wollen.</p>
        <a href="mailto:karriere@astrid-lindgren-zentrum.at" class="btn btn-primary" style="margin-top: var(--space-4);">E-Mail senden</a>
      </div>
    </div>
  </Section>
<script is:inline>
  function toggleJobDetails(jobId) {
    const details = document.getElementById(`details-${jobId}`);
    const btn = document.querySelector(`[data-job-id="${jobId}"] .btn-details`);
    const icon = btn.querySelector('.btn-icon');
    const text = btn.querySelector('.btn-text');

    if (details.style.display === 'none') {
      details.style.display = 'block';
      icon.textContent = '‚ñ≤';
      text.textContent = 'Weniger anzeigen';
      btn.classList.add('active');

      // Smooth scroll to details
      setTimeout(() => {
        details.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    } else {
      details.style.display = 'none';
      icon.textContent = '‚ñº';
      text.textContent = 'Mehr erfahren';
      btn.classList.remove('active');
    }
  }
</script>

<style>
  .jobs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
    gap: 2rem;
  }

  .job-card {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    transition: box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
  }

  .job-card:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  .job-header {
    margin-bottom: 1rem;
  }

  .job-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--color-gray-900);
    margin: 0;
  }

  .job-short-desc {
    color: var(--color-gray-600);
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }

  .job-short-desc p {
    margin: 0;
  }

  .btn-details {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: transparent;
    border: 2px solid var(--color-gray-200);
    border-radius: 0.5rem;
    color: var(--color-gray-700);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
  }

  .btn-details:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
  }

  .btn-details.active {
    background: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
  }

  .btn-icon {
    font-size: 0.8rem;
    transition: transform 0.3s ease;
  }

  .job-details {
    animation: slideDown 0.3s ease;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .details-content {
    padding: 1.5rem;
    background: var(--color-gray-50);
    border-radius: 0.75rem;
    margin-bottom: 1.5rem;
  }

  /* Rich Text Content Styles */
  .rich-text-content :global(h1) {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--color-gray-900);
  }

  .rich-text-content :global(h2) {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 1.5rem 0 0.75rem;
    color: var(--color-gray-900);
  }

  .rich-text-content :global(h3) {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 1.25rem 0 0.5rem;
    color: var(--color-gray-800);
  }

  .rich-text-content :global(p) {
    margin-bottom: 1rem;
    line-height: 1.7;
    color: var(--color-gray-700);
  }

  .rich-text-content :global(ul),
  .rich-text-content :global(ol) {
    margin: 1rem 0;
    padding-left: 1.5rem;
  }

  .rich-text-content :global(li) {
    margin-bottom: 0.5rem;
    line-height: 1.6;
  }

  .rich-text-content :global(strong) {
    font-weight: 600;
    color: var(--color-gray-900);
  }

  .rich-text-content :global(a) {
    color: var(--color-primary);
    text-decoration: underline;
  }

  .rich-text-content :global(blockquote) {
    border-left: 4px solid var(--color-primary);
    padding-left: 1rem;
    margin: 1rem 0;
    color: var(--color-gray-600);
    font-style: italic;
  }

  .rich-text-content :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
  }

  .rich-text-content :global(th),
  .rich-text-content :global(td) {
    padding: 0.75rem;
    border: 1px solid var(--color-gray-200);
    text-align: left;
  }

  .rich-text-content :global(th) {
    background: var(--color-gray-100);
    font-weight: 600;
  }

  .job-media {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-gray-200);
  }

  .job-media h4 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--color-gray-800);
  }

  .media-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .media-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: white;
    border: 1px solid var(--color-gray-200);
    border-radius: 0.5rem;
    text-decoration: none;
    color: var(--color-gray-700);
    transition: all 0.3s ease;
  }

  .media-item:hover {
    border-color: var(--color-primary);
    background: var(--color-gray-50);
  }

  .media-icon {
    font-size: 1.25rem;
  }

  .media-title {
    font-size: 0.9rem;
    font-weight: 500;
  }

  .job-actions {
    margin-top: auto;
    padding-top: 1.5rem;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.875rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .btn-primary {
    background: var(--color-primary);
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  /* Empty State */
  .empty-jobs {
    text-align: center;
    padding: 3rem;
    background: var(--color-gray-50);
    border-radius: 1rem;
  }

  .empty-text {
    font-size: 1.1rem;
    color: var(--color-gray-700);
    margin-bottom: 0.5rem;
  }

  .empty-subtext {
    color: var(--color-gray-500);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .jobs-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .job-card {
      padding: 1.5rem;
    }

    .details-content {
      padding: 1rem;
    }
  }
</style>
</BaseLayout>
